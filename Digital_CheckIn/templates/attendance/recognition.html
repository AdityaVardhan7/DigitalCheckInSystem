{% extends "admin/sidebar.html" %} {% block content %}
{% load static %}

<style>
    #videoElement {
        width: 100%;
        height: auto;
    }
    #checkInBtn {
        padding: 10px 20px;
        font-size: 18px;
        background-color: green;
        color: white;
        border: none;
        cursor: pointer;
    }
</style>

<h1>Face Recognition Check-in</h1>
    <video id="videoElement" autoplay></video>
    <button id="checkInBtn" onclick="checkIn()">Check-in</button>

    <script>
        let video = document.getElementById("videoElement");
        let checkInBtn = document.getElementById("checkInBtn");
        let isFaceRecognized = false;

        // Start the webcam feed
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                video.srcObject = stream;
            })
            .catch(function(error) {
                console.log("Error accessing webcam: ", error);
            });

        // Function to send face recognition status to the server
        function sendFaceRecognitionStatus() {
            fetch('/recognize_face/', {
                method: 'POST',
                body: JSON.stringify({}),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.faceRecognized) {
                    isFaceRecognized = true;
                    // Optionally, show a message or indicator that face is recognized
                    console.log("Face Recognized!");
                } else {
                    isFaceRecognized = false;
                    console.log("Face not recognized.");
                }
            });
        }

        // Periodically check for face recognition
        setInterval(sendFaceRecognitionStatus, 1000);

        // Function to perform check-in
        function checkIn() {
            if (isFaceRecognized) {
                // If the face is recognized, perform check-in
                fetch('/check_in/', {
                    method: 'POST',
                    body: JSON.stringify({}),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => alert('Check-in successful!'))
                .catch(error => console.log("Error during check-in:", error));
            } else {
                // If the face is not recognized, show a message to the user
                alert("Face not recognized. Please make sure you're facing the camera.");
            }
        }
    </script>

{% endblock content %}